<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Apartamento</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <h1>Cadastro de Apartamento</h1>

    <form action="/cadastro" method="POST">
        <label for="nome">Nome:</label><br>
        <input type="text" id="nome" name="nome" required><br>

        <label for="descricao">Descrição:</label><br>
        <input type="text" id="descricao" name="descricao" required><br>

        <!-- Campos ocultos para latitude e longitude -->
        <input type="hidden" id="latitude" name="latitude">
        <input type="hidden" id="longitude" name="longitude">

        <button type="submit">Cadastrar Apartamento</button>
    </form>

    <!-- Mapa -->
    <div id="map" style="height: 500px; width: 100%;"></div>

    <script>
        var map = L.map('map').setView([-5.0917, -42.8012], 13); // Coordenadas iniciais

        // Adicionar o TileLayer do OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Função para obter a localização do usuário
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var userLat = position.coords.latitude;
                    var userLng = position.coords.longitude;

                    // Centraliza o mapa na localização do usuário
                    map.setView([userLat, userLng], 13);

                    // Adiciona um marcador na posição do usuário
                    L.marker([userLat, userLng]).addTo(map)
                        .bindPopup("Você está aqui!");

                    // Preenche os campos de latitude e longitude com as coordenadas do usuário
                    document.getElementById("latitude").value = userLat;
                    document.getElementById("longitude").value = userLng;

                }, function() {
                    alert("Não foi possível obter a localização.");
                });
            } else {
                alert("Geolocalização não é suportada por este navegador.");
            }
        }

        // Chama a função para obter a localização do usuário
        getUserLocation();

        // Variável global para armazenar o marcador do apartamento
        var apartmentMarker;

        // Quando o mapa for clicado, adiciona o marcador do apartamento
        map.on('click', function(e) {
            var lat = e.latlng.lat;
            var lng = e.latlng.lng;

            // Atualiza ou adiciona o marcador do apartamento
            if (apartmentMarker) {
                apartmentMarker.setLatLng([lat, lng]);
            } else {
                apartmentMarker = L.marker([lat, lng]).addTo(map);
            }

            // Atualiza os campos de latitude e longitude do apartamento
            document.getElementById("latitude").value = lat;
            document.getElementById("longitude").value = lng;
        });
    </script>
</body>
</html>
